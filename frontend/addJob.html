<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recruiters Dairy</title>
    <link rel="stylesheet" href="style.css">

    <script>
        function save() {
            const objectJob = {};
            const form = document.getElementById("form1")
            const jobId1 = form.querySelector("input").value
            const jobDescription = form.querySelector("textarea").value
            objectJob.jobid = jobId1
            objectJob.description = jobDescription
            const candidates = [];
            const div1 = document.getElementById('divmain');
            div1.querySelectorAll("fieldset").forEach(i => {
                const objectCandidate = {}
                const e = i.querySelectorAll("div")
                e.forEach(m => {
                    const canInput = m.querySelector('input')
                    if (canInput.id.endsWith('name')) {
                        objectCandidate.name = canInput.value
                    }
                    if (canInput.id.endsWith('phone')) {
                        objectCandidate.phone = canInput.value
                    }
                    if (canInput.id.endsWith('address')) {
                        objectCandidate.address = canInput.value
                    }
                    if (canInput.id.endsWith('email')) {
                        objectCandidate.email = canInput.value
                    }
                });
                const canText = i.querySelector('textarea').value
                objectCandidate.notes = canText
                candidates.push(objectCandidate)
            });
            objectJob.candidates = candidates

            let jobs = JSON.parse(localStorage.getItem('jobs'));
            if (!jobs) {
                jobs = [];
            }
            let indexOfJob;
            if (location.search.length > 0) {
                var qureyString = location.search.substring(1);
                console.log(qureyString);
                var jobidSplit = qureyString.split("=");
                var jobidValue = jobidSplit[1];
                if (jobidValue) {
                    indexOfJob = jobs.map((j) => {
                        return j.jobid;
                    }).indexOf(jobidValue);
                }
            }

            if (jobs) {
                if (indexOfJob > -1) {
                    jobs[indexOfJob] = objectJob
                } else {
                    jobs.push(objectJob);
                }
            }
            else {
                jobs = [];

                jobs.push(objectJob);
            }

            localStorage.setItem('jobs', JSON.stringify(jobs));
        }

        var candidateCounter = 0;
        function addCandidateForm(candidate) {
            if (!candidate) {
                candidate = { name: '', address: '', email: '', phone: '', notes: '' };
            }
            candidateCounter++
            const div1 = document.getElementById('divmain');

            var fieldSet = document.createElement('fieldset');
            var legend = document.createElement('legend');

            var newCandidate = document.createElement('h4');
            newCandidate.innerHTML = `Candidate : ${candidateCounter}`;

            var divName = document.createElement('div');
            var newCanNameLabel = document.createElement('label');
            newCanNameLabel.innerText = "Name of Candidate :"
            var newCanNameInput = document.createElement('input');
            newCanNameInput.setAttribute("style", "margin-left:35px")
            newCanNameInput.setAttribute("id", "candidate" + `${candidateCounter}` + "name")
            newCanNameInput.value = candidate.name;

            var divAddress = document.createElement('div');
            var newAddressLabel = document.createElement('label');
            newAddressLabel.innerText = "Address of Candidate  :"
            var newAddressInput = document.createElement('input');
            newAddressInput.setAttribute("type", "address");
            newAddressInput.setAttribute("style", "margin-left:20px")
            newAddressInput.setAttribute("id", "candidate" + `${candidateCounter}` + "address")
            newAddressInput.value = candidate.address;

            var divPhone = document.createElement('div');
            var newCanPhoneLabel = document.createElement('label');
            newCanPhoneLabel.innerText = "PhoneNo of Candidate  :"
            var newPhoneInput = document.createElement('input');
            newPhoneInput.setAttribute("type", "phonenumber");
            newPhoneInput.setAttribute("style", "margin-left:13px")
            newPhoneInput.setAttribute("id", "candidate" + `${candidateCounter}` + "phone")
            newPhoneInput.value = candidate.phone;

            var divEmail = document.createElement('div');
            var newCanEmailLabel = document.createElement('label');
            newCanEmailLabel.innerText = "Email of Candidate :"
            var newCanEmailInput = document.createElement('input');
            newCanEmailInput.setAttribute("type", "email");
            newCanEmailInput.setAttribute("style", "margin-left:34px")
            newCanEmailInput.setAttribute("id", "candidate" + `${candidateCounter}` + "email")
            newCanEmailInput.value = candidate.email;

            var newCanTextareaInput = document.createElement('textarea');
            newCanTextareaInput.innerText = "Add Notes"
            newCanTextareaInput.setAttribute("cols", "44");
            newCanTextareaInput.value = candidate.notes


            div1.append(fieldSet);
            fieldSet.append(legend);
            legend.append(newCandidate)

            fieldSet.append(divName);
            divName.append(newCanNameLabel);
            divName.append(newCanNameInput);


            fieldSet.append(divAddress);
            divAddress.append(newAddressLabel);
            divAddress.append(newAddressInput);

            fieldSet.append(divPhone)
            divPhone.append(newCanPhoneLabel);
            divPhone.append(newPhoneInput);

            fieldSet.append(divEmail)
            divEmail.append(newCanEmailLabel);
            divEmail.append(newCanEmailInput);

            fieldSet.append(newCanTextareaInput);
        }

    </script>

</head>

<body>

    <h1 class="mainheading">Recruiters Dairy</h1>
    <form action="" id="form1">
        <label for=" jobId">Job Id</label>
        <input style="margin-left: 8px;" id="jobId" type="number" required>&nbsp;&nbsp;
        <label for="jobDescription">Job Description</label>
        <textarea style="margin-left: 8px;" name="" id="jobDescription" cols="20" rows="1"></textarea>
        <input id="searchtext" type="text"><button type="button" onclick="load()">Search</button>
        <br><br>
        <button onclick="addCandidateForm()" type="button">Add new candidate</button>
        <div id="divmain"></div>
        <button id="savebutton" type="button" onclick="save()">Save</button>




    </form>

</body>
<script>
    function load() {
        document.getElementById("divmain").innerHTML = "";
        if (location.search.length > 0) {
            var qureyString = location.search.substring(1);
        }
        var jobidSplit = qureyString.split("=");
        var jobidValue = jobidSplit[1];
        if (jobidValue != 0 || jobidValue != null) {

            var jobs = JSON.parse(localStorage.getItem('jobs'));

            if (!jobs) {
                jobs = [];
            }
            jobs.forEach(e => {
                if (e.jobid == jobidValue) {
                    var elementfilljobid = document.getElementById('jobId');
                    elementfilljobid.setAttribute('disabled', 'disabled');
                    elementfilljobid.value = e.jobid
                    var elementfilljobdes = document.getElementById('jobDescription')
                    elementfilljobdes.value = e.description
                    const elementSearch = document.getElementById('searchtext');
                    const filterCandidates = e.candidates.filter(
                        c => c.name.indexOf(elementSearch.value) > -1
                    );
                    filterCandidates.forEach(function (candidate) {
                        addCandidateForm(candidate);
                    });
                    return;

                }
            })
        }
    }
    load();


</script>


</html>