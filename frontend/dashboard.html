<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Dashboard</title>
    <script>
        (() => {
            const currentUsers = JSON.parse(localStorage.getItem("currentUser"));
            console.log(currentUsers);
            if (currentUsers && currentUsers != null) {
                if (currentUsers.roleId == "2") {
                }
                else {
                    alert("You are not allowed in this page")
                    window.location = 'login.html';
                }
            }
            else {
                alert("You are not allower to view this page")
                window.location = "login.html"
            }
        })();

    </script>
</head>

<body>
    <h1 class="banner">Recruiters Dairy</h1>
    <hr>
    <button class="buttonClass" onclick="searchToday()" type="button">Today</button>
    <button class="buttonClass" onclick="searchToday()" type="button">Yesterday</button>
    <button class="buttonClass" onclick="searchToday()" type="button">This Month</button>
    <div id="divJobs">
    </div>
</body>
<script>

    function newJobs() {

        jobs = JSON.parse(localStorage.getItem('jobs'));
        let currentUser = JSON.parse(localStorage.getItem("currentUser"));
        const divJobs = document.getElementById('divJobs');

        if (!jobs || !jobs.length) {
            const divResult = document.createElement("div");
            divResult.innerText = "NO Results Found";
            divJobs.appendChild(divResult);
            return;
        }

        const table = document.createElement('table');
        table.setAttribute("border", "2");

        const trh1 = document.createElement('tr');
        const tdh1 = document.createElement('td')
        tableHeader1 = document.createElement('th4');
        tableHeader1.innerText = 'Name Of The Recruiter';
        tdh1.appendChild(tableHeader1);
        trh1.appendChild(tdh1);
        tableHeader1.setAttribute("style", "padding:12px");

        tableHeader2 = document.createElement('th4');
        tableHeader2.innerText = 'No of Jobs';
        const tdh2 = document.createElement('td');
        tdh2.appendChild(tableHeader2);
        trh1.appendChild(tdh2);
        tableHeader2.setAttribute("style", "padding:12px");

        tableHeader3 = document.createElement('th4');
        tableHeader3.innerText = 'Job Id';
        const tdh3 = document.createElement('td');
        tdh3.appendChild(tableHeader3);
        trh1.appendChild(tdh3);
        tableHeader3.setAttribute("style", "padding:12px");

        tableHeader4 = document.createElement('th4');
        tableHeader4.innerText = 'Job Description';
        const tdh4 = document.createElement('td');
        tdh4.appendChild(tableHeader4);
        trh1.appendChild(tdh4);
        tableHeader4.setAttribute("style", "padding:12px");

        tableHeader5 = document.createElement('th4');
        tableHeader5.innerText = 'No of candidates';
        const tdh5 = document.createElement('td');
        tdh5.appendChild(tableHeader5);
        trh1.appendChild(tdh5);
        tableHeader5.setAttribute("style", "padding:12px");

        table.appendChild(trh1);

        const tablebody = document.createElement('tbody');

        let text;
        let noOfJobs = 0;

        for (let i = 0; i < jobs.length; i++) {
            text = document.createTextNode(jobs[i].createdBy);
            var arry = [];
            arry = currentUser.teamMembers.filter(p => p)
            for (let j = 0; j < arry.length; j++) {
                if (text.nodeValue == arry[j]) {
                    noOfJobs++
       
                    textOfJobs = document.createTextNode(noOfJobs);
                    textOfJobId = document.createTextNode(jobs[i].jobid);
                    textOfJobDescription = document.createTextNode(jobs[i].description);
                    textOfJobNoOfCandidates = document.createTextNode(jobs[i].candidates.length);
       
                    const tr1 = document.createElement("tr");
                    const td1 = document.createElement("td");
                    const td2 = document.createElement("td");
                    const td3 = document.createElement("td");
                    const td4 = document.createElement("td");
                    const td5 = document.createElement("td");

                    td1.append(text);
                    td2.append(textOfJobs.nodeValue);
                    td3.append(textOfJobId.nodeValue);
                    td4.append(textOfJobDescription.nodeValue);
                    td5.append(textOfJobNoOfCandidates.nodeValue);
       
                    tr1.appendChild(td1);
                    tr1.appendChild(td2);
                    tr1.appendChild(td3);
                    tr1.appendChild(td4);
                    tr1.appendChild(td5);
                    tablebody.appendChild(tr1);
       
                    noOfJobs = 0;
                }
            }
         
        }
        table.appendChild(tablebody);
        divJobs.appendChild(table);
    }
    newJobs();

</script>

</html>